<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RETRO // GitHub Agent</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=VT323&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --green: #00ff41; --dark-green: #003b00; --black: #0a0a0a;
      --dim-green: #00aa2a; --red: #ff3131; --amber: #ffb300; --blue: #00cfff;
    }
    body {
      background: var(--black); color: var(--green);
      font-family: 'Share Tech Mono', monospace;
      min-height: 100vh; display: flex; flex-direction: column;
      align-items: center; justify-content: center; padding: 2rem; overflow-x: hidden;
    }
    body::before {
      content: ''; position: fixed; inset: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.15) 2px, rgba(0,0,0,0.15) 4px);
      pointer-events: none; z-index: 999;
    }
    @keyframes flicker { 0%,100%{opacity:1} 93%{opacity:0.8} 97%{opacity:0.9} }
    body { animation: flicker 8s infinite; }
    .container { width: 100%; max-width: 700px; }
    .header { text-align: center; margin-bottom: 2rem; }
    .ascii-title {
      font-family: 'VT323', monospace; font-size: clamp(2.5rem, 8vw, 5rem);
      color: var(--green); text-shadow: 0 0 20px var(--green), 0 0 40px var(--dark-green);
      letter-spacing: 0.1em; line-height: 1;
    }
    .subtitle { font-size: 0.75rem; color: var(--dim-green); letter-spacing: 0.3em; margin-top: 0.5rem; }
    .blink { animation: blink 1s step-end infinite; }
    @keyframes blink { 50%{opacity:0} }
    .terminal {
      border: 1px solid var(--dim-green);
      box-shadow: 0 0 20px rgba(0,255,65,0.1), inset 0 0 20px rgba(0,0,0,0.5);
      background: rgba(0,20,0,0.6);
    }
    .terminal-bar {
      background: var(--dark-green); padding: 0.4rem 1rem;
      display: flex; align-items: center; gap: 0.5rem; border-bottom: 1px solid var(--dim-green);
    }
    .dot { width: 10px; height: 10px; border-radius: 50%; }
    .dot-r{background:var(--red)} .dot-y{background:var(--amber)} .dot-g{background:var(--green)}
    .terminal-title { font-size: 0.7rem; color: var(--dim-green); letter-spacing: 0.2em; margin: 0 auto; }
    .terminal-body { padding: 1.5rem; }
    .mode-toggle { display: flex; margin-bottom: 1.5rem; border: 1px solid var(--dim-green); }
    .mode-btn {
      flex: 1; background: transparent; border: none; color: var(--dim-green);
      font-family: 'Share Tech Mono', monospace; font-size: 0.75rem; padding: 0.6rem;
      cursor: pointer; letter-spacing: 0.2em; text-transform: uppercase; transition: all 0.2s;
    }
    .mode-btn.active { background: var(--dark-green); color: var(--green); }
    .mode-btn:not(.active):hover { color: var(--green); }
    .mode-btn+.mode-btn { border-left: 1px solid var(--dim-green); }
    .field { margin-bottom: 1.2rem; }
    label { display: block; font-size: 0.7rem; color: var(--dim-green); letter-spacing: 0.2em; margin-bottom: 0.4rem; text-transform: uppercase; }
    label span { color: var(--green); }
    input, textarea, select {
      width: 100%; background: rgba(0,10,0,0.8); border: 1px solid var(--dim-green);
      color: var(--green); font-family: 'Share Tech Mono', monospace; font-size: 0.9rem;
      padding: 0.65rem 0.9rem; outline: none; transition: border-color 0.2s, box-shadow 0.2s;
      resize: none; -webkit-appearance: none;
    }
    input:focus, textarea:focus, select:focus { border-color: var(--green); box-shadow: 0 0 10px rgba(0,255,65,0.2); }
    input::placeholder, textarea::placeholder { color: #004a00; }
    textarea { height: 90px; }
    select option { background: #001000; }
    .row { display: flex; gap: 0.5rem; }
    .row input { flex: 1; }
    .btn-small {
      background: transparent; border: 1px solid var(--dim-green); color: var(--dim-green);
      font-family: 'Share Tech Mono', monospace; font-size: 0.7rem; padding: 0 0.75rem;
      cursor: pointer; letter-spacing: 0.1em; transition: all 0.2s; white-space: nowrap;
    }
    .btn-small:hover { border-color: var(--green); color: var(--green); }
    .btn-run {
      width: 100%; background: transparent; border: 1px solid var(--green); color: var(--green);
      font-family: 'VT323', monospace; font-size: 1.8rem; padding: 0.6rem; cursor: pointer;
      letter-spacing: 0.3em; text-transform: uppercase; transition: all 0.2s;
      position: relative; overflow: hidden; margin-top: 0.5rem;
    }
    .btn-run:hover:not(:disabled) { background: var(--green); color: var(--black); box-shadow: 0 0 30px rgba(0,255,65,0.4); }
    .btn-run:disabled { opacity: 0.5; cursor: not-allowed; }
    @keyframes scanBtn { 0%{transform:translateX(-100%)} 100%{transform:translateX(100%)} }
    .btn-run.loading::after {
      content: ''; position: absolute; top: 0; left: 0; width: 40%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0,255,65,0.3), transparent);
      animation: scanBtn 1s linear infinite;
    }
    .log {
      margin-top: 1.2rem; border: 1px solid var(--dark-green); background: rgba(0,5,0,0.9);
      padding: 0.9rem; min-height: 70px; max-height: 180px; overflow-y: auto;
      font-size: 0.78rem; line-height: 1.6;
    }
    .log:empty::before { content: '> awaiting command...'; color: #003300; }
    .log-line { display: block; }
    .log-line.info{color:var(--dim-green)} .log-line.success{color:var(--green)}
    .log-line.error{color:var(--red)} .log-line.warn{color:var(--amber)} .log-line.blue{color:var(--blue)}
    .divider { border: none; border-top: 1px solid var(--dark-green); margin: 1.2rem 0; }
    .config-section summary {
      font-size: 0.7rem; color: var(--dim-green); letter-spacing: 0.2em;
      cursor: pointer; text-transform: uppercase; margin-bottom: 1rem; list-style: none;
    }
    .config-section summary::before { content: '▶ '; }
    .config-section[open] summary::before { content: '▼ '; }
    .config-section[open] .field { margin-top: 0.8rem; }
    .footer { text-align: center; margin-top: 1.2rem; font-size: 0.65rem; color: #003300; letter-spacing: 0.2em; }
    ::-webkit-scrollbar{width:4px} ::-webkit-scrollbar-track{background:var(--black)} ::-webkit-scrollbar-thumb{background:var(--dark-green)}
    .hidden { display: none; }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="ascii-title">RETRO<span class="blink">_</span></div>
    <div class="subtitle">// github agent // powered by claude code //</div>
  </div>

  <div class="terminal">
    <div class="terminal-bar">
      <div class="dot dot-r"></div><div class="dot dot-y"></div><div class="dot dot-g"></div>
      <span class="terminal-title">agent.exe — bash — 80×24</span>
    </div>
    <div class="terminal-body">

      <div class="mode-toggle">
        <button class="mode-btn active" onclick="setMode('edit')" id="btn-edit">✎ EDIT REPO</button>
        <button class="mode-btn" onclick="setMode('create')" id="btn-create">+ CREATE REPO</button>
      </div>

      <!-- EDIT MODE -->
      <div id="mode-edit">
        <div class="field">
          <label><span>$</span> TARGET_REPO</label>
          <input type="text" id="edit-repo" placeholder="retro_github-agent" />
        </div>
        <div class="field">
          <label><span>$</span> PROMPT</label>
          <textarea id="edit-prompt" placeholder="Run this exact bash command: echo Hello World > hello.txt"></textarea>
        </div>
        <button class="btn-run" id="runBtn" onclick="runEdit()">▶ EXECUTE</button>
      </div>

      <!-- CREATE MODE -->
      <div id="mode-create" class="hidden">
        <div class="field">
          <label><span>$</span> NEW_REPO_NAME</label>
          <input type="text" id="create-repo" placeholder="my-awesome-project" />
        </div>
        <div class="field">
          <label><span>$</span> DESCRIPTION (optional)</label>
          <input type="text" id="create-desc" placeholder="A cool project" />
        </div>
        <div class="field">
          <label><span>$</span> VISIBILITY</label>
          <select id="create-visibility">
            <option value="public">PUBLIC</option>
            <option value="private">PRIVATE</option>
          </select>
        </div>
        <div class="field">
          <label><span>$</span> WHAT TO BUILD</label>
          <textarea id="create-prompt" placeholder="Create a Node.js Express API with a /health endpoint"></textarea>
        </div>
        <button class="btn-run" id="createBtn" onclick="runCreate()">▶ CREATE + BUILD</button>
      </div>

      <div class="log" id="log"></div>

      <hr class="divider">

      <details class="config-section">
        <summary>CONFIG</summary>
        <div class="field">
          <label><span>$</span> SERVER_URL</label>
          <div class="row">
            <input type="text" id="serverUrl" placeholder="https://xxxx.ngrok-free.dev/webhook" />
            <button class="btn-small" onclick="saveConfig()">SAVE</button>
          </div>
        </div>
        <div class="field">
          <label><span>$</span> GITHUB_TOKEN</label>
          <div class="row">
            <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx" />
            <button class="btn-small" onclick="saveConfig()">SAVE</button>
          </div>
        </div>
        <div class="field">
          <label><span>$</span> GITHUB_USERNAME</label>
          <div class="row">
            <input type="text" id="githubUsername" placeholder="sameermotwani17-cell" />
            <button class="btn-small" onclick="saveConfig()">SAVE</button>
          </div>
        </div>
      </details>

    </div>
  </div>
  <div class="footer">sameermotwani17-cell // retro-github-agent // v2.0</div>
</div>

<script>
  function loadConfig() {
    document.getElementById('serverUrl').value = localStorage.getItem('agentServerUrl') || '';
    document.getElementById('githubToken').value = localStorage.getItem('agentGithubToken') || '';
    document.getElementById('githubUsername').value = localStorage.getItem('agentGithubUsername') || 'sameermotwani17-cell';
  }
  function saveConfig() {
    const url = document.getElementById('serverUrl').value.trim();
    const token = document.getElementById('githubToken').value.trim();
    const username = document.getElementById('githubUsername').value.trim();
    if (url) localStorage.setItem('agentServerUrl', url);
    if (token) localStorage.setItem('agentGithubToken', token);
    if (username) localStorage.setItem('agentGithubUsername', username);
    addLog('> config saved.', 'success');
  }
  loadConfig();

  function setMode(mode) {
    document.getElementById('mode-edit').classList.toggle('hidden', mode !== 'edit');
    document.getElementById('mode-create').classList.toggle('hidden', mode !== 'create');
    document.getElementById('btn-edit').classList.toggle('active', mode === 'edit');
    document.getElementById('btn-create').classList.toggle('active', mode === 'create');
    document.getElementById('log').innerHTML = '';
  }

  function addLog(msg, type='info') {
    const log = document.getElementById('log');
    const line = document.createElement('span');
    line.className = `log-line ${type}`;
    line.textContent = msg;
    log.appendChild(line);
    log.appendChild(document.createElement('br'));
    log.scrollTop = log.scrollHeight;
  }

  function setBtn(id, loading, text) {
    const btn = document.getElementById(id);
    btn.disabled = loading;
    btn.classList.toggle('loading', loading);
    btn.textContent = loading ? '⟳ RUNNING...' : text;
  }

  async function runEdit() {
    const serverUrl = localStorage.getItem('agentServerUrl');
    const repo = document.getElementById('edit-repo').value.trim();
    const prompt = document.getElementById('edit-prompt').value.trim();
    if (!serverUrl) return addLog('> ERROR: save server url in config first.', 'error');
    if (!repo) return addLog('> ERROR: repo is required.', 'error');
    if (!prompt) return addLog('> ERROR: prompt is required.', 'error');

    document.getElementById('log').innerHTML = '';
    setBtn('runBtn', true, '▶ EXECUTE');
    addLog(`> target: ${repo}`, 'info');
    addLog(`> prompt: ${prompt.slice(0,60)}${prompt.length>60?'...':''}`, 'info');
    addLog('> spawning claude code...', 'info');

    try {
      const res = await fetch(serverUrl, {
        method: 'POST',
        headers: {'Content-Type':'application/json','ngrok-skip-browser-warning':'true'},
        body: JSON.stringify({repo, prompt})
      });
      const data = await res.json();
      if (data.status === 'success') {
        if (data.committed) {
          addLog(`> changes pushed to ${data.repo}`, 'success');
          addLog('> DONE. check github.', 'success');
        } else {
          addLog('> no changes detected.', 'warn');
          addLog(`> claude: ${(data.claudeOutput||'').slice(0,120)}`, 'warn');
        }
      } else {
        addLog(`> ERROR: ${data.error}`, 'error');
      }
    } catch(err) {
      addLog(`> FETCH ERROR: ${err.message}`, 'error');
      addLog('> is your server running? is ngrok online?', 'warn');
    }
    setBtn('runBtn', false, '▶ EXECUTE');
  }

  async function runCreate() {
    const token = localStorage.getItem('agentGithubToken');
    const username = localStorage.getItem('agentGithubUsername') || 'sameermotwani17-cell';
    const serverUrl = localStorage.getItem('agentServerUrl');
    const repoName = document.getElementById('create-repo').value.trim();
    const desc = document.getElementById('create-desc').value.trim();
    const visibility = document.getElementById('create-visibility').value;
    const prompt = document.getElementById('create-prompt').value.trim();

    if (!token) return addLog('> ERROR: add github token in config first.', 'error');
    if (!serverUrl) return addLog('> ERROR: save server url in config first.', 'error');
    if (!repoName) return addLog('> ERROR: repo name is required.', 'error');
    if (!prompt) return addLog('> ERROR: prompt is required.', 'error');

    document.getElementById('log').innerHTML = '';
    setBtn('createBtn', true, '▶ CREATE + BUILD');
    addLog(`> creating repo: ${username}/${repoName}...`, 'info');

    try {
      const ghRes = await fetch('https://api.github.com/user/repos', {
        method: 'POST',
        headers: {'Authorization':`token ${token}`,'Content-Type':'application/json'},
        body: JSON.stringify({name:repoName, description:desc, private:visibility==='private', auto_init:true})
      });
      const ghData = await ghRes.json();
      if (!ghRes.ok) {
        addLog(`> GITHUB ERROR: ${ghData.message}`, 'error');
        setBtn('createBtn', false, '▶ CREATE + BUILD');
        return;
      }
      addLog(`> repo created: ${ghData.html_url}`, 'success');
      addLog('> waiting for github to initialize...', 'info');
      await new Promise(r => setTimeout(r, 2000));
      addLog('> spawning claude code...', 'info');

      const res = await fetch(serverUrl, {
        method: 'POST',
        headers: {'Content-Type':'application/json','ngrok-skip-browser-warning':'true'},
        body: JSON.stringify({repo: repoName, prompt})
      });
      const data = await res.json();
      if (data.status === 'success') {
        if (data.committed) {
          addLog(`> code pushed to ${ghData.html_url}`, 'success');
          addLog('> DONE. repo is live on github.', 'success');
        } else {
          addLog('> repo created but no changes committed.', 'warn');
        }
      } else {
        addLog(`> AGENT ERROR: ${data.error}`, 'error');
      }
    } catch(err) {
      addLog(`> ERROR: ${err.message}`, 'error');
    }
    setBtn('createBtn', false, '▶ CREATE + BUILD');
  }
</script>
</body>
</html>
